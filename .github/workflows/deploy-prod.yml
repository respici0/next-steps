name: ðŸš¢ Deploy Production

permissions:
  contents: write
  issues: read
  pull-requests: write

on:
  push:
    branches: [main]
  workflow_dispatch:

concurrency:
  group: production-deploy
  cancel-in-progress: false

jobs:
  # test:
  #   name: Run Tests
  #   uses: ./.github/workflows/testing.yml
  #   secrets: inherit

  deploy:
    name: Deploy Production
    uses: ./.github/workflows/deploy.yml
    with:
      environment: 'Production'
      production: true
    secrets: inherit

  summary:
    name: Production Summary
    runs-on: ubuntu-latest
    needs: [deploy]
    if: needs.deploy.result == 'success'
    steps:
      - name: Production Deployment Summary
        run: |
          # Create GitHub workflow summary
          cat >> $GITHUB_STEP_SUMMARY << EOF
          ## ðŸš¢ Production Deployment Successful!

          | Item | Details |
          |------|---------|
          | ðŸ”— **Deployment URL** | [${{ needs.deploy.outputs.deployment-url }}](${{ needs.deploy.outputs.deployment-url }}) |
          | ðŸ”€ **Branch** | \`${{ github.ref }}\` |

          EOF
